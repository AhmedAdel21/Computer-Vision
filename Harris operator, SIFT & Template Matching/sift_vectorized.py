import numpy as np
import cv2 as cv



def main_oriantation(img,key_points):
    '''
    params:
        img: gray scale image
        key_points: list of oe key points each point is list [x,y]
    return:
        new_key_points : new key points each points is list [x,y,oriantations]
    '''
    NUM_BINS=36
    BIN_WIDTH=10

    new_key_points=[]
    
    SIGMA=1.6 # from the algoritm's paper
    kernal_size=int(2 * np.ceil(SIGMA * 1.5) + 1)
    
    #filters to get the gradients
    filterX=np.array([[-1] ,[0] , [1]])
    filterY=filterX.T
    #applying the filters
    IX=cv.filter2D(src=img,ddepth=-1,kernel=filterX)
    IY=cv.filter2D(src=img,ddepth=-1, kernel=filterY)
    #
    
    magnitude=np.sqrt(IX * IX + IY * IY)
    oriantation=np.rad2deg(np.arctan2(IY,IX)) % 360
    #
    for point in key_points:
        x,y=int(point[0]),int(point[1])
        hist=np.zeros(NUM_BINS, dtype=np.float32)
        sub_img=np.array(img[x - 3:x + 4, y - 3:y + 4])
        if(sub_img.shape[0] != 7 or sub_img.shape[1] != 7):
            continue
        else:
            sub_magnitude=np.array(magnitude[x - 3:x + 4, y - 3:y + 4])
            sub_oriantation=np.array(oriantation[x - 3:x + 4, y - 3:y + 4])
            weighted_magnitude=cv.GaussianBlur(np.float32(sub_magnitude),(kernal_size,kernal_size),SIGMA)


            #histogram
            for i in range(7):
                for j in range(7):
                    bin_idx=int(np.floor(sub_oriantation[i][j]) // 10)
                    hist[bin_idx]+=weighted_magnitude[i][j]

            #find the main oriantation
            max_dir=np.argmax(hist)
            max_val=hist[max_dir]
            angle=((max_dir+1) * (10)) % 360
            new_key_points.append([x,y,angle])
            #find new key points
            for idx,mag in enumerate(hist):
                if idx == max_dir :continue
                if mag > .8 * max_val:
                    angle=((max_dir+1) * (10)) % 360
                    new_key_points.append([x,y,angle])
    return new_key_points

def get_descriptors(img , key_points):
    '''
    params:
        img: gray scale image
        key_points: list of oe key points each point is list [x,y,oriatation]
    return:
        new key points :add descriptors for each key with size =128
        
    '''
    NUM_BINS=8
    BIN_WIDTH=45
   
    new_key_points=[]
    SIGMA=1.6
    
    #filters to get the gradients
    filterX=np.array([[-1] ,[0] , [1]])
    filterY=filterX.T
    #applying the filters
    IX=cv.filter2D(src=img,ddepth=-1,kernel=filterX)
    IY=cv.filter2D(src=img,ddepth=-1, kernel=filterY)
    #
    
    #
    magnitude=np.sqrt(IX * IX + IY * IY)
    oriantation=np.rad2deg(np.arctan2(IY,IX)) % 360
    #
    for point in key_points:
        x,y,angle=int(point[0]), int(point[1]), point[2]
        #get 15 * 15 image
        sub_img=img[x - 8 : x + 7 , y - 8 : y + 7]
        if(sub_img.shape[0] != 15 or sub_img.shape[1] != 15):
            continue
        else:          
            sub_oriant=oriantation[x - 8 : x + 7 , y - 8 : y + 7]
            sub_mag=magnitude[x - 8 : x + 7 , y - 8 : y + 7]
            weighted_mag=cv.GaussianBlur(np.float32(sub_mag),(15,15),SIGMA)

            #subtract the main oriantation
            sub_oriant=(((sub_oriant-angle) % 360)* (8/360.)) .astype(int)
            features=[]
            for i in range(4):
                for j in range(4):
                    sub_region_mag=weighted_mag[i * 4:(i + 1) * 4, j * 4:(j + 1) * 4]
                    sub_region_oriant=sub_oriant[i * 4:(i + 1) * 4, j * 4:(j + 1) * 4]
                    hist=np.zeros(8,dtype=np.float32)
                    for bin in range(8):
                        hist[bin]=np.sum(sub_region_mag[sub_region_oriant == bin ])
                    features.extend(hist.tolist())

            features /= (np.linalg.norm(np.array(features)))
            features = np.clip(features, np.finfo(np.float16).eps, 0.2)
            features /= (np.linalg.norm(features))
            new_key_points.append([x,y,oriantation,features])

    return  new_key_points
        

filename = 'cat.jpeg'
img = cv.imread(filename)
gray = cv.cvtColor(img,cv.COLOR_BGR2GRAY)
key_points=[
    (3, 64), (3, 65), (3, 66), (4, 64), (4, 65), (4, 66), (4, 67), (5, 64), (5, 65), (5, 66), (5, 67), (6, 64), (6, 65), (6, 66), (6, 67), (8, 59), (8, 60), (8, 61), (8, 62), (8, 63), (8, 64), (9, 59), (9, 60), (9, 61), (9, 62), (9, 63), (9, 64), (10, 59), (10, 60), (10, 61), (10, 62), (10, 63), (10, 64), (11, 59), (11, 60), (11, 61), (11, 62), (11, 63), (11, 64), (12, 59), (12, 60), (12, 61), (12, 62), (12, 63), (12, 64), (12, 65), (13, 59), (13, 60), (13, 61), (13, 62), (13, 63), (13, 64), (13, 65), (14, 59), (14, 60), (14, 61), (14, 62), (14, 63), (14, 64), (14, 65), (15, 60), (15, 61), (15, 62), (15, 63), (15, 64), (15, 65), (16, 60), (16, 61), (16, 62), (16, 63), (16, 64), (16, 65), (22, 57), (22, 58), (22, 59), (22, 60), (22, 61), (22, 62), (22, 214), (22, 215), (22, 216), (23, 57), (23, 58), (23, 59), (23, 60), (23, 61), (23, 62), (23, 214), (23, 215), (23, 216), (24, 57), (24, 58), (24, 59), (24, 60), (24, 61), (24, 62), (24, 63), (24, 214), (24, 215), (24, 216), (25, 60), (25, 61), (25, 62), (25, 63), (26, 60), (26, 61), (26, 62), (26, 63), (30, 57), (30, 58), (30, 59), (30, 60), (30, 61), (31, 57), (31, 58), (31, 59), (31, 60), (31, 61), (32, 57), (32, 58), (32, 59), (32, 60), (32, 61), (33, 57), (33, 58), (33, 59), (38, 99), (38, 100), (38, 101), (39, 99), (39, 100), (39, 101), (39, 102), (40, 99), (40, 100), (40, 101), (40, 102), (41, 100), (41, 101), (41, 102), (41, 107), (41, 108), (41, 109), (41, 110), (42, 107), (42, 108), (42, 109), (42, 110), (43, 107), (43, 108), (43, 109), (43, 110), (44, 107), (44, 108), (44, 109), (44, 110), (49, 110), (49, 111), (49, 112), (49, 113), (50, 101), (50, 102), (50, 103), (50, 110), (50, 111), (50, 112), (50, 113), (50, 114), (51, 101), (51, 102), (51, 103), (51, 104), (51, 110), (51, 111), (51, 112), (51, 113), (51, 114), (51, 164), (51, 165), (51, 166), (52, 101), (52, 102), (52, 103), (52, 104), (52, 107), (52, 108), (52, 109), (52, 110), (52, 111), (52, 112), (52, 113), (52, 114), (52, 162), (52, 163), (52, 164), (52, 165), (52, 166), (53, 101), (53, 102), (53, 103), (53, 104), (53, 107), (53, 108), (53, 109), (53, 110), (53, 111), (53, 112), (53, 113), (53, 114), (53, 162), (53, 163), (53, 164), (53, 165), (53, 166), (54, 102), (54, 103), (54, 104), (54, 107), (54, 108), (54, 109), (54, 110), (54, 111), (54, 112), (54, 113), (54, 114), (54, 115), (54, 117), (54, 118), (54, 119), (54, 162), (54, 163), (54, 164), (54, 165), (54, 166), (55, 107), (55, 108), (55, 109), (55, 110), (55, 111), (55, 112), (55, 113), (55, 114), (55, 115), (55, 117), (55, 118), (55, 119), (55, 162), (55, 163), (55, 164), (55, 165), (56, 107), (56, 108), (56, 109), (56, 110), (56, 111), (56, 112), (56, 113), (56, 114), (56, 115), (56, 117), (56, 118), (56, 119), (57, 108), (57, 109), (57, 110), (57, 111), (57, 112), (57, 113), (57, 114), (57, 115), (57, 117), (57, 118), (57, 119), (58, 105), (58, 106), (58, 107), (58, 108), (58, 109), (58, 110), (58, 111), (58, 112), (58, 113), (58, 114), (58, 115), (59, 105), (59, 106), (59, 107), (59, 108), (59, 109), (59, 110), (59, 111), (59, 112), (59, 113), (59, 114), (59, 115), (60, 105), (60, 106), (60, 107), (60, 108), (60, 109), (60, 110), (60, 111), (60, 112), (60, 113), (60, 114), (60, 115), (60, 154), (60, 155), (60, 156), (60, 157), (60, 158), (61, 105), (61, 106), (61, 107), (61, 108), (61, 109), (61, 110), (61, 111), (61, 112), (61, 113), (61, 114), (61, 154), (61, 155), (61, 156), (61, 157), (61, 158), (62, 105), (62, 106), (62, 107), (62, 108), (62, 109), (62, 110), (62, 111), (62, 112), (62, 113), (62, 114), (62, 115), (62, 153), (62, 154), (62, 155), (62, 156), (62, 157), (62, 158), (63, 106), (63, 107), (63, 108), (63, 109), (63, 110), (63, 111), (63, 112), (63, 113), (63, 114), (63, 115), (63, 153), (63, 154), (63, 155), (63, 156), (63, 157), (63, 158), (64, 107), (64, 108), (64, 109), (64, 110), (64, 111), (64, 112), (64, 113), (64, 114), (64, 115), (64, 153), (64, 154), (64, 155), (64, 156), (64, 157), (64, 158), (64, 159), (64, 160), (65, 108), (65, 109), (65, 110), (65, 111), (65, 112), (65, 113), (65, 114), (65, 153), (65, 154), (65, 155), (65, 156), (65, 157), (65, 158), (65, 159), (65, 160), (66, 109), (66, 110), (66, 111), (66, 112), (66, 117), (66, 118), (66, 119), (66, 156), (66, 157), (66, 158), (66, 159), (66, 160), (67, 117), (67, 118), (67, 119), (67, 120), (67, 156), (67, 157), (67, 158), (67, 159), (67, 160), (68, 92), (68, 93), (68, 94), (68, 117), (68, 118), (68, 119), (68, 120), (68, 156), (68, 157), (68, 158), (68, 159), (69, 92), (69, 93), (69, 94), (69, 95), (69, 117), (69, 118), (69, 119), (69, 120), (69, 156), (69, 157), (69, 158), (70, 92), (70, 93), (70, 94), (70, 95), (70, 117), (70, 118), (70, 119), (71, 93), (71, 94), (71, 95), (74, 147), (74, 148), (74, 149), (74, 150), (75, 147), (75, 148), (75, 149), (75, 150), (76, 122), (76, 123), (76, 124), (76, 147), (76, 148), (76, 149), (76, 150), (77, 122), (77, 123), (77, 124), (77, 125), (77, 147), (77, 148), (77, 149), (77, 150), (78, 114), (78, 115), (78, 116), (78, 117), (78, 118), (78, 119), (78, 122), (78, 123), (78, 124), (78, 125), (79, 114), (79, 115), (79, 116), (79, 117), (79, 118), (79, 119), (79, 122), (79, 123), (79, 124), (79, 125), (80, 114), (80, 115), (80, 116), (80, 117), (80, 118), (80, 119), (81, 114), (81, 115), (81, 116), (81, 117), (81, 118), (81, 119), (82, 200), (82, 201), (82, 202), (82, 203), (83, 199), (83, 200), (83, 201), (83, 202), (83, 203), (84, 108), (84, 109), (84, 110), (84, 111), (84, 112), (84, 115), (84, 116), (84, 117), (84, 199), (84, 200), (84, 201), (84, 202), (84, 203), (85, 108), (85, 109), (85, 110), (85, 111), (85, 112), (85, 114), (85, 115), (85, 116), (85, 117), (85, 199), (85, 200), (85, 201), (85, 202), (85, 203), (86, 108), (86, 109), (86, 110), (86, 111), (86, 112), (86, 114), (86, 115), (86, 116), (86, 117), (86, 155), (86, 156), (86, 157), (87, 99), (87, 100), (87, 101), (87, 108), (87, 109), (87, 110), (87, 111), (87, 112), (87, 114), (87, 115), (87, 116), (87, 117), (87, 118), (87, 139), (87, 140), (87, 141), (87, 142), (87, 154), (87, 155), (87, 156), (87, 157), (88, 98), (88, 99), (88, 100), (88, 101), (88, 102), (88, 108), (88, 109), (88, 110), (88, 111), (88, 112), (88, 115), (88, 116), (88, 117), (88, 118), (88, 119), (88, 138), (88, 139), (88, 140), (88, 141), (88, 142), (88, 154), (88, 155), (88, 156), (88, 157), (89, 98), (89, 99), (89, 100), (89, 101), (89, 102), (89, 103), (89, 104), (89, 108), (89, 109), (89, 110), (89, 111), (89, 112), (89, 115), (89, 116), (89, 117), (89, 118), (89, 119), (89, 138), (89, 139), (89, 140), (89, 141), (89, 142), (89, 143), (89, 154), (89, 155), (89, 156), (90, 98), (90, 99), (90, 100), (90, 101), (90, 102), (90, 103), (90, 104), (90, 105), (90, 106), (90, 109), (90, 110), (90, 111), (90, 115), (90, 116), (90, 117), (90, 118), (90, 119), (90, 138), (90, 139), (90, 140), (90, 141), (90, 142), (90, 143), (90, 144), (91, 98), (91, 99), (91, 100), (91, 101), (91, 102), (91, 103), (91, 104), (91, 105), (91, 106), (91, 107), (91, 116), (91, 117), (91, 118), (91, 119), (91, 138), (91, 139), (91, 140), (91, 141), (91, 142), (91, 143), (91, 144), (92, 99), (92, 100), (92, 101), (92, 102), (92, 103), (92, 104), (92, 105), (92, 106), (92, 107), (92, 116), (92, 117), (92, 118), (92, 119), (92, 138), (92, 139), (92, 140), (92, 141), (92, 142), (92, 143), (92, 144), (93, 87), (93, 88), (93, 89), (93, 90), (93, 91), (93, 99), (93, 100), (93, 101), (93, 102), (93, 103), (93, 104), (93, 105), (93, 106), (93, 107), (93, 117), (93, 118), (93, 119), (93, 138), (93, 139), (93, 140), (93, 141), (93, 142), (94, 87), (94, 88), (94, 89), (94, 90), (94, 91), (94, 100), (94, 101), (94, 102), (94, 103), (94, 104), (94, 105), (94, 106), (94, 107), (94, 117), (94, 118), (94, 119), (94, 139), (94, 140), (94, 141), (95, 87), (95, 88), (95, 89), (95, 90), (95, 91), (95, 103), (95, 104), (95, 105), (95, 106), (95, 107), (95, 117), (95, 118), (95, 119), (95, 132), (95, 133), (95, 134), (95, 135), (95, 136), (95, 142), (95, 143), (95, 144), (95, 145), (96, 87), (96, 88), (96, 89), (96, 90), (96, 91), (96, 104), (96, 105), (96, 106), (96, 116), (96, 117), (96, 118), (96, 119), (96, 131), (96, 132), (96, 133), (96, 134), (96, 135), (96, 136), (96, 137), (96, 142), (96, 143), (96, 144), (96, 145), (96, 146), (97, 88), (97, 89), (97, 90), (97, 116), (97, 117), (97, 118), (97, 119), (97, 127), (97, 128), (97, 129), (97, 131), (97, 132), (97, 133), (97, 134), (97, 135), (97, 136), (97, 137), (97, 141), (97, 142), (97, 143), (97, 144), (97, 145), (97, 146), (97, 147), (98, 102), (98, 103), (98, 104), (98, 105), (98, 113), (98, 114), (98, 115), (98, 116), (98, 117), (98, 118), (98, 119), (98, 127), (98, 128), (98, 129), (98, 131), (98, 132), (98, 133), (98, 134), (98, 135), (98, 136), (98, 137), (98, 138), (98, 139), (98, 140), (98, 141), (98, 142), (98, 143), (98, 144), (98, 145), (98, 146), (98, 147), (99, 102), (99, 103), (99, 104), (99, 105), (99, 106), (99, 112), (99, 113), (99, 114), (99, 115), (99, 116), (99, 117), (99, 118), (99, 119), (99, 125), (99, 126), (99, 127), (99, 128), (99, 129), (99, 131), (99, 132), (99, 133), (99, 134), (99, 135), (99, 136), (99, 137), (99, 138), (99, 139), (99, 140), (99, 141), (99, 142), (99, 143), (99, 144), (99, 145), (99, 146), (99, 147), (100, 100), (100, 101), (100, 102), (100, 103), (100, 104), (100, 105), (100, 106), (100, 111), (100, 112), (100, 113), (100, 114), (100, 115), (100, 116), (100, 117), (100, 118), (100, 119), (100, 125), (100, 126), (100, 127), (100, 128), (100, 129), (100, 130), (100, 131), (100, 132), (100, 133), (100, 134), (100, 137), (100, 138), (100, 139), (100, 140), (100, 141), (100, 142), (100, 143), (100, 144), (100, 145), (100, 146), (100, 147), (101, 100), (101, 101), (101, 102), (101, 103), (101, 104), (101, 105), (101, 106), (101, 107), (101, 108), (101, 110), (101, 111), (101, 112), (101, 113), (101, 114), (101, 115), (101, 116), (101, 117), (101, 118), (101, 125), (101, 126), (101, 127), (101, 128), (101, 129), (101, 130), (101, 131), (101, 132), (101, 141), (101, 142), (101, 143), (101, 144), (101, 145), (101, 146), (101, 147), (101, 148), (101, 149), (102, 99), (102, 100), (102, 101), (102, 102), (102, 103), (102, 104), (102, 105), (102, 106), (102, 107), (102, 108), (102, 110), (102, 111), (102, 112), (102, 113), (102, 114), (102, 115), (102, 116), (102, 117), (102, 125), (102, 126), (102, 127), (102, 128), (102, 129), (102, 130), (102, 131), (102, 132), (102, 143), (102, 144), (102, 145), (102, 146), (102, 147), (102, 148), (102, 149), (103, 94), (103, 95), (103, 96), (103, 97), (103, 98), (103, 99), (103, 100), (103, 101), (103, 102), (103, 103), (103, 104), (103, 105), (103, 106), (103, 107), (103, 108), (103, 110), (103, 111), (103, 112), (103, 113), (103, 114), (103, 115), (103, 116), (103, 117), (103, 130), (103, 131), (103, 132), (103, 143), (103, 144), (103, 145), (103, 146), (103, 147), (103, 148), (103, 149), (104, 72), (104, 73), (104, 74), (104, 75), (104, 76), (104, 77), (104, 94), (104, 95), (104, 96), (104, 97), (104, 98), (104, 99), (104, 100), (104, 101), (104, 102), (104, 103), (104, 104), (104, 105), (104, 106), (104, 107), (104, 108), (104, 110), (104, 111), (104, 112), (104, 113), (104, 114), (104, 115), (104, 116), (104, 117), (104, 143), (104, 144), (104, 145), (104, 146), (104, 147), (104, 148), (104, 149), (105, 72), (105, 73), (105, 74), (105, 75), (105, 76), (105, 77), (105, 78), (105, 81), (105, 82), (105, 83), (105, 84), (105, 94), (105, 95), (105, 96), (105, 97), (105, 98), (105, 99), (105, 100), (105, 101), (105, 119), (105, 120), (105, 121), (105, 144), (105, 145), (105, 146), (105, 147), (105, 148), (105, 149), (106, 70), (106, 71), (106, 72), (106, 73), (106, 74), (106, 75), (106, 76), (106, 77), (106, 78), (106, 79), (106, 80), (106, 81), (106, 82), (106, 83), (106, 84), (106, 85), (106, 86), (106, 95), (106, 96), (106, 97), (106, 98), (106, 99), (106, 100), (106, 101), (106, 119), (106, 120), (106, 121), (106, 143), (106, 144), (106, 145), (106, 146), (107, 69), (107, 70), (107, 71), (107, 72), (107, 73), (107, 74), (107, 75), (107, 76), (107, 77), (107, 78), (107, 79), (107, 80), (107, 81), (107, 82), (107, 83), (107, 84), (107, 85), (107, 86), (107, 98), (107, 99), (107, 100), (107, 101), (107, 119), (107, 120), (107, 121), (107, 143), (107, 144), (107, 145), (107, 146), (108, 69), (108, 70), (108, 71), (108, 72), (108, 73), (108, 74), (108, 77), (108, 78), (108, 79), (108, 80), (108, 81), (108, 82), (108, 83), (108, 84), (108, 85), (108, 86), (108, 91), (108, 92), (108, 93), (108, 98), (108, 99), (108, 100), (108, 101), (108, 102), (108, 141), (108, 142), (108, 143), (108, 144), (108, 145), (108, 146), (109, 69), (109, 70), (109, 71), (109, 72), (109, 73), (109, 74), (109, 77), (109, 78), (109, 79), (109, 80), (109, 81), (109, 82), (109, 83), (109, 84), (109, 85), (109, 86), (109, 91), (109, 92), (109, 93), (109, 98), (109, 99), (109, 100), (109, 101), (109, 102), (109, 139), (109, 140), (109, 141), (109, 142), (109, 143), (109, 144), (109, 145), (109, 146), (109, 147), (109, 148), (109, 149), (109, 150), (109, 151), (109, 152), (110, 69), (110, 70), (110, 71), (110, 72), (110, 73), (110, 77), (110, 78), (110, 79), (110, 80), (110, 81), (110, 82), (110, 83), (110, 84), (110, 85), (110, 91), (110, 92), (110, 93), (110, 100), (110, 101), (110, 102), (110, 139), (110, 140), (110, 141), (110, 142), (110, 143), (110, 144), (110, 145), (110, 146), (110, 147), (110, 148), (110, 149), (110, 150), (110, 151), (110, 152), (111, 69), (111, 70), (111, 71), (111, 72), (111, 77), (111, 78), (111, 79), (111, 80), (111, 81), (111, 82), (111, 83), (111, 84), (111, 91), (111, 92), (111, 93), (111, 139), (111, 140), (111, 141), (111, 142), (111, 143), (111, 144), (111, 145), (111, 146), (111, 147), (111, 148), (111, 149), (111, 150), (111, 151), (111, 152), (112, 77), (112, 78), (112, 79), (112, 80), (112, 81), (112, 82), (112, 83), (112, 140), (112, 141), (112, 142), (112, 143), (112, 144), (112, 145), (112, 146), (112, 147), (112, 148), (112, 149), (112, 150), (112, 151), (113, 77), (113, 78), (113, 79), (113, 80), (113, 81), (113, 82), (113, 83), (113, 87), (113, 88), (113, 89), (113, 90), (113, 142), (113, 143), (113, 144), (113, 145), (113, 146), (113, 147), (114, 77), (114, 78), (114, 79), (114, 80), (114, 81), (114, 87), (114, 88), (114, 89), (114, 90), (114, 142), (114, 143), (114, 144), (114, 145), (114, 146), (114, 147), (115, 78), (115, 79), (115, 80), (115, 86), (115, 87), (115, 88), (115, 89), (115, 90), (115, 142), (115, 143), (115, 144), (115, 145), (115, 146), (115, 167), (115, 168), (115, 169), (115, 170), (115, 171), (115, 172), (116, 86), (116, 87), (116, 88), (116, 89), (116, 90), (116, 99), (116, 100), (116, 101), (116, 142), (116, 143), (116, 144), (116, 161), (116, 162), (116, 163), (116, 164), (116, 165), (116, 166), (116, 167), (116, 168), (116, 169), (116, 170), (116, 171), (116, 172), (116, 173), (116, 174), (116, 175), (116, 176), (117, 86), (117, 87), (117, 88), (117, 89), (117, 90), (117, 99), (117, 100), (117, 101), (117, 102), (117, 161), (117, 162), (117, 163), (117, 164), (117, 165), (117, 166), (117, 167), (117, 168), (117, 169), (117, 170), (117, 171), (117, 172), (117, 173), (117, 174), (117, 175), (117, 176), (117, 177), (117, 178), (118, 87), (118, 88), (118, 89), (118, 90), (118, 99), (118, 100), (118, 101), (118, 102), (118, 161), (118, 162), (118, 163), (118, 164), (118, 165), (118, 166), (118, 167), (118, 168), (118, 169), (118, 170), (118, 171), (118, 172), (118, 173), (118, 174), (118, 175), (118, 176), (118, 177), (118, 178), (119, 99), (119, 100), (119, 101), (119, 102), (119, 161), (119, 162), (119, 163), (119, 164), (119, 165), (119, 166), (119, 167), (119, 168), (119, 169), (119, 170), (119, 171), (119, 172), (119, 173), (119, 174), (119, 175), (119, 176), (119, 177), (119, 178), (120, 99), (120, 100), (120, 101), (120, 162), (120, 163), (120, 164), (120, 165), (120, 167), (120, 168), (120, 169), (120, 170), (120, 173), (120, 174), (120, 175), (120, 176), (120, 177), (120, 178), (121, 99), (121, 100), (121, 101), (121, 156), (121, 157), (121, 158), (121, 159), (121, 174), (121, 175), (121, 176), (121, 177), (121, 178), (122, 99), (122, 100), (122, 101), (122, 156), (122, 157), (122, 158), (122, 159), (122, 160), (122, 174), (122, 175), (122, 176), (122, 177), (122, 178), (123, 156), (123, 157), (123, 158), (123, 159), (123, 160), (123, 175), (123, 176), (123, 177), (123, 178), (124, 99), (124, 100), (124, 101), (124, 156), (124, 157), (124, 158), (124, 159), (124, 160), (125, 99), (125, 100), (125, 101), (125, 102), (125, 156), (125, 157), (125, 158), (125, 159), (125, 160), (126, 99), (126, 100), (126, 101), (126, 102), (126, 156), (126, 157), (126, 158), (126, 159), (126, 160), (127, 95), (127, 96), (127, 97), (127, 99), (127, 100), (127, 101), (127, 102), (128, 92), (128, 93), (128, 94), (128, 95), (128, 96), (128, 97), (128, 98), (128, 99), (128, 100), (128, 101), (128, 102), (128, 140), (128, 141), (128, 142), (129, 89), (129, 90), (129, 91), (129, 92), (129, 93), (129, 94), (129, 95), (129, 96), (129, 97), (129, 98), (129, 139), (129, 140), (129, 141), (129, 142), (130, 88), (130, 89), (130, 90), (130, 91), (130, 92), (130, 93), (130, 94), (130, 95), (130, 96), (130, 97), (130, 98), (130, 138), (130, 139), (130, 140), (130, 141), (130, 142), (131, 88), (131, 89), (131, 90), (131, 91), (131, 92), (131, 93), (131, 94), (131, 95), (131, 96), (131, 97), (131, 98), (131, 99), (131, 100), (131, 137), (131, 138), (131, 139), (131, 140), (131, 141), (131, 142), (132, 88), (132, 89), (132, 90), (132, 91), (132, 92), (132, 93), (132, 94), (132, 95), (132, 98), (132, 99), (132, 100), (132, 136), (132, 137), (132, 138), (132, 139), (132, 140), (132, 141), (132, 142), (133, 94), (133, 95), (133, 96), (133, 97), (133, 98), (133, 99), (133, 100), (133, 135), (133, 136), (133, 137), (133, 138), (133, 139), (133, 140), (133, 141), (133, 142), (134, 91), (134, 92), (134, 93), (134, 94), (134, 95), (134, 96), (134, 97), (134, 135), (134, 136), (134, 137), (134, 138), (134, 139), (134, 140), (134, 141), (134, 142), (135, 89), (135, 90), (135, 91), (135, 92), (135, 93), (135, 94), (135, 95), (135, 96), (135, 97), (135, 135), (135, 136), (135, 137), (135, 138), (135, 139), (135, 140), (135, 141), (135, 142), (136, 89), (136, 90), (136, 91), (136, 92), (136, 93), (136, 94), (136, 95), (136, 96), (136, 135), (136, 136), (136, 137), (136, 138), (136, 139), (136, 185), (136, 186), (136, 187), (136, 188), (137, 89), (137, 90), (137, 91), (137, 92), (137, 93), (137, 94), (137, 95), (137, 96), (137, 185), (137, 186), (137, 187), (137, 188), (138, 89), (138, 90), (138, 91), (138, 92), (138, 93), (138, 94), (138, 95), (138, 96), (138, 185), (138, 186), (138, 187), (138, 188), (139, 92), (139, 93), (139, 94), (139, 95), (150, 98), (150, 99), (150, 100), (150, 101), (151, 97), (151, 98), (151, 99), (151, 100), (151, 101), (151, 102), (152, 97), (152, 98), (152, 99), (152, 100), (152, 101), (152, 102), (152, 103), (153, 97), (153, 98), (153, 99), (153, 100), (153, 101), (153, 102), (153, 103), (153, 125), (153, 126), (153, 127), (153, 128), (153, 129), (154, 97), (154, 98), (154, 99), (154, 100), (154, 101), (154, 102), (154, 103), (154, 125), (154, 126), (154, 127), (154, 128), (154, 129), (154, 130), (155, 98), (155, 99), (155, 100), (155, 101), (155, 102), (155, 103), (155, 125), (155, 126), (155, 127), (155, 128), (155, 129), (155, 130), (156, 99), (156, 100), (156, 101), (156, 102), (156, 103), (156, 104), (156, 107), (156, 108), (156, 109), (156, 124), (156, 125), (156, 126), (156, 127), (156, 128), (156, 129), (156, 130), (157, 99), (157, 100), (157, 101), (157, 102), (157, 103), (157, 104), (157, 105), (157, 106), (157, 107), (157, 108), (157, 109), (157, 110), (157, 122), (157, 123), (157, 124), (157, 125), (157, 126), (157, 127), (157, 128), (157, 129), (157, 130), (158, 100), (158, 101), (158, 102), (158, 103), (158, 104), (158, 105), (158, 106), (158, 107), (158, 108), (158, 109), (158, 110), (158, 115), (158, 116), (158, 117), (158, 118), (158, 119), (158, 121), (158, 122), (158, 123), (158, 124), (158, 125), (158, 126), (158, 127), (158, 128), (158, 129), (158, 130), (159, 102), (159, 103), (159, 104), (159, 105), (159, 106), (159, 107), (159, 108), (159, 109), (159, 110), (159, 111), (159, 112), (159, 113), (159, 115), (159, 116), (159, 117), (159, 118), (159, 119), (159, 120), (159, 121), (159, 122), (159, 123), (159, 124), (159, 125), (159, 126), (159, 127), (159, 128), (160, 104), (160, 105), (160, 106), (160, 107), (160, 108), (160, 109), (160, 110), (160, 111), (160, 112), (160, 113), (160, 115), (160, 116), (160, 117), (160, 118), (160, 119), (160, 120), (160, 121), (160, 122), (160, 123), (160, 124), (160, 125), (160, 126), (161, 104), (161, 105), (161, 106), (161, 107), (161, 108), (161, 109), (161, 110), (161, 111), (161, 112), (161, 113), (161, 114), (161, 115), (161, 116), (161, 117), (161, 118), (161, 119), (161, 120), (161, 121), (161, 122), (161, 123), (161, 124), (161, 125), (162, 104), (162, 105), (162, 106), (162, 107), (162, 108), (162, 109), (162, 110), (162, 111), (162, 112), (162, 113), (162, 114), (162, 115), (162, 116), (162, 117), (162, 118), (162, 119), (162, 120), (163, 104), (163, 105), (163, 106), (163, 107), (163, 108), (163, 109), (163, 110), (163, 111), (163, 112), (163, 113), (163, 114), (163, 115), (163, 116), (163, 117), (163, 118), (163, 119), (163, 120), (164, 106), (164, 107), (164, 108), (164, 109), (164, 110), (164, 111), (164, 112), (164, 113), (164, 114), (164, 115), (164, 116), (164, 117), (164, 118), (164, 119), (165, 107), (165, 108), (165, 109), (165, 110), (165, 111), (165, 113), (165, 114), (165, 115), (165, 116), (165, 117), (166, 113), (166, 114), (166, 115), (166, 116), (166, 117), (169, 161), (169, 162), (169, 163), (169, 164), (169, 165), (170, 159), (170, 160), (170, 161), (170, 162), (170, 163), (170, 164), (170, 165), (170, 166), (170, 167), (171, 159), (171, 160), (171, 161), (171, 162), (171, 163), (171, 164), (171, 165), (171, 166), (171, 167), (172, 158), (172, 159), (172, 160), (172, 161), (172, 162), (172, 163), (172, 164), (172, 165), (172, 166), (172, 167), (173, 158), (173, 159), (173, 160), (173, 161), (173, 162), (173, 163), (174, 158), (174, 159), (174, 160), (174, 161), (174, 162), (175, 158), (175, 159), (175, 160), (175, 161), (175, 162), (176, 155), (176, 156), (176, 157), (176, 158), (176, 159), (176, 160), (176, 161), (176, 162), (177, 155), (177, 156), (177, 157), (177, 158), (177, 159), (178, 155), (178, 156), (178, 157), (178, 158), (178, 159), (179, 156), (179, 157), (179, 158), (179, 159)]
new_key_points=main_oriantation(gray,key_points)
print(np.array(new_key_points).shape)
new_key_points=get_descriptors(gray,new_key_points)
# new_key_points=local_descriptors(gray,new_key_points)
print(np.array(key_points).shape)
print(np.array(new_key_points).shape)

